From 51fe9caa2c9ea787ff1e13693e42e3ca61e52b02 Mon Sep 17 00:00:00 2001
From: Konsta <konsta09@gmail.com>
Date: Wed, 27 Jun 2012 18:33:13 +0300
Subject: [PATCH] option to change status bar transparency (2/2)

ported from AOKP

Change-Id: I717048f4631b21c3b08cca4cb87c44ede2c5677f
---
 core/java/android/provider/Settings.java           |    6 ++++++
 .../com/android/systemui/statusbar/StatusBar.java  |   11 ++++++++++-
 2 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index e99749f..6cbd74d 100644
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -2604,6 +2604,12 @@ public final class Settings {
         public static final String POWER_DIALOG_SHOW_SOUND_TOGGLE = "power_dialog_show_sound_toggle";
 
         /**
+         * Option to change statusbar transparency
+         * @hide
+         */
+        public static final String STATUSBAR_TRANSPARENCY = "statusbar_transparency";
+
+        /**
          * Settings to backup. This is here so that it's in the same place as the settings
          * keys and easy to update.
          *
diff --git a/packages/SystemUI/src/com/android/systemui/statusbar/StatusBar.java b/packages/SystemUI/src/com/android/systemui/statusbar/StatusBar.java
index 7ca1b22..b9021f0 100644
--- a/packages/SystemUI/src/com/android/systemui/statusbar/StatusBar.java
+++ b/packages/SystemUI/src/com/android/systemui/statusbar/StatusBar.java
@@ -118,6 +118,9 @@ public abstract class StatusBar extends SystemUI implements CommandQueue.Callbac
 
         // Put up the view
         final int height = getStatusBarHeight();
+        final int transparency = Settings.System.getInt(
+                                        sb.getContext().getContentResolver(),
+                                        Settings.System.STATUSBAR_TRANSPARENCY, 100);
 
         final WindowManager.LayoutParams lp = new WindowManager.LayoutParams(
                 ViewGroup.LayoutParams.MATCH_PARENT,
@@ -129,7 +132,13 @@ public abstract class StatusBar extends SystemUI implements CommandQueue.Callbac
                 // We use a pixel format of RGB565 for the status bar to save memory bandwidth and
                 // to ensure that the layer can be handled by HWComposer.  On some devices the
                 // HWComposer is unable to handle SW-rendered RGBX_8888 layers.
-                PixelFormat.RGB_565);
+               (transparency != 100 ? PixelFormat.TRANSPARENT : PixelFormat.RGB_565));
+
+        if (transparency != 100) {
+            sb.setBackgroundColor(
+                (int) (((float)transparency / 100.0F) * 255) * 0x1000000);
+        }
+        //sb.setBackgroundColor(144 * 0x1000000);
         
         // the status bar should be in an overlay if possible
         final Display defaultDisplay 
-- 
1.7.9.5

