From de917e623ab02d325f705d2f5a516562f5a77f28 Mon Sep 17 00:00:00 2001
From: Konsta <konsta09@gmail.com>
Date: Tue, 19 Jun 2012 11:34:38 +0300
Subject: [PATCH 08/17] option to hide items from power menu (1/2)

Change-Id: Ic39d0d6c12ea891bd844d15128981d900596cf8a
---
 core/java/android/provider/Settings.java           |   10 ++
 .../internal/policy/impl/GlobalActions.java        |  112 ++++++++++++--------
 2 files changed, 80 insertions(+), 42 deletions(-)

diff --git a/core/java/android/provider/Settings.java b/core/java/android/provider/Settings.java
index 6f04898..cba9f53 100644
--- a/core/java/android/provider/Settings.java
+++ b/core/java/android/provider/Settings.java
@@ -2616,6 +2616,16 @@ public final class Settings {
         public static final String KONSTA_NAVBAR = "konsta_navbar";
 
         /**
+         * Options to hide items from power menu
+         * @hide
+         */
+        public static final String POWER_DIALOG_SHOW_REBOOT_TOGGLE = "power_dialog_show_reboot_toggle";
+        public static final String POWER_DIALOG_SHOW_PROFILE_TOGGLE = "power_dialog_show_profile_toggle";
+        public static final String POWER_DIALOG_SHOW_SCREENSHOT_TOGGLE = "power_dialog_show_screenshot_toggle";
+        public static final String POWER_DIALOG_SHOW_AIRPLANE_TOGGLE = "power_dialog_show_airplane_toggle";
+        public static final String POWER_DIALOG_SHOW_SOUND_TOGGLE = "power_dialog_show_sound_toggle";
+
+        /**
          * Settings to backup. This is here so that it's in the same place as the settings
          * keys and easy to update.
          *
diff --git a/policy/src/com/android/internal/policy/impl/GlobalActions.java b/policy/src/com/android/internal/policy/impl/GlobalActions.java
index ee16a10..b3e9457 100644
--- a/policy/src/com/android/internal/policy/impl/GlobalActions.java
+++ b/policy/src/com/android/internal/policy/impl/GlobalActions.java
@@ -95,6 +95,12 @@ class GlobalActions implements DialogInterface.OnDismissListener, DialogInterfac
 
     private Profile mChosenProfile;
 
+    private boolean mEnableRebootToggle = true;
+    private boolean mEnableProfileToggle = true;
+    private boolean mEnableScreenshotToggle = true;
+    private boolean mEnableAirplaneToggle = true;
+    private boolean mEnableSoundToggle = true;
+
     /**
      * @param context everything needs a context :(
      */
@@ -128,9 +134,9 @@ class GlobalActions implements DialogInterface.OnDismissListener, DialogInterfac
             mDialog.dismiss();
             mDialog = null;
         }
-        if (mDialog == null) {
-            mDialog = createDialog();
-        }
+        // always create the power menu dialog
+        mDialog = createDialog();
+
         prepareDialog();
 
         mDialog.show();
@@ -149,6 +155,18 @@ class GlobalActions implements DialogInterface.OnDismissListener, DialogInterfac
      * @return A new dialog.
      */
     private AlertDialog createDialog() {
+
+        mEnableRebootToggle = Settings.System.getInt(mContext.getContentResolver(),
+                Settings.System.POWER_DIALOG_SHOW_REBOOT_TOGGLE, 1) == 1;
+        mEnableProfileToggle = Settings.System.getInt(mContext.getContentResolver(),
+                Settings.System.POWER_DIALOG_SHOW_PROFILE_TOGGLE, 1) == 1;
+        mEnableScreenshotToggle = Settings.System.getInt(mContext.getContentResolver(),
+                Settings.System.POWER_DIALOG_SHOW_SCREENSHOT_TOGGLE, 1) == 1;
+        mEnableAirplaneToggle = Settings.System.getInt(mContext.getContentResolver(),
+                Settings.System.POWER_DIALOG_SHOW_AIRPLANE_TOGGLE, 1) == 1;
+        mEnableSoundToggle = Settings.System.getInt(mContext.getContentResolver(),
+                Settings.System.POWER_DIALOG_SHOW_SOUND_TOGGLE, 1) == 1;
+
         mSilentModeAction = new SilentModeAction(mAudioManager, mHandler);
 
         mAirplaneModeOn = new ToggleAction(
@@ -214,59 +232,69 @@ class GlobalActions implements DialogInterface.OnDismissListener, DialogInterfac
             });
 
         // next: reboot
-        mItems.add(
-            new SinglePressAction(com.android.internal.R.drawable.ic_lock_reboot, R.string.global_action_reboot) {
-                public void onPress() {
-                    ShutdownThread.reboot(getUiContext(), "null", true);
-                }
+        if(mEnableRebootToggle) {
+            mItems.add(
+                new SinglePressAction(com.android.internal.R.drawable.ic_lock_reboot, R.string.global_action_reboot) {
+                    public void onPress() {
+                        ShutdownThread.reboot(getUiContext(), "null", true);
+                    }
 
-                public boolean showDuringKeyguard() {
-                    return true;
-                }
+                    public boolean showDuringKeyguard() {
+                        return true;
+                    }
 
-                public boolean showBeforeProvisioning() {
-                    return true;
-                }
-            });
+                    public boolean showBeforeProvisioning() {
+                        return true;
+                    }
+                });
+        }
 
         // next: profile
-        mItems.add(
-            new ProfileChooseAction() {
-                public void onPress() {
-                    createProfileDialog();
-                }
+        if(mEnableProfileToggle) {
+            mItems.add(
+                new ProfileChooseAction() {
+                    public void onPress() {
+                        createProfileDialog();
+                    }
 
-                public boolean showDuringKeyguard() {
-                    return false;
-                }
+                    public boolean showDuringKeyguard() {
+                        return false;
+                    }
 
-                public boolean showBeforeProvisioning() {
-                    return false;
-                }
-            });
+                    public boolean showBeforeProvisioning() {
+                        return false;
+                    }
+                });
+        }
 
         // next: screenshot
-        mItems.add(
-            new SinglePressAction(com.android.internal.R.drawable.ic_lock_screenshot, R.string.global_action_screenshot) {
-                public void onPress() {
-                    takeScreenshot();
-                }
+        if(mEnableScreenshotToggle) {
+            mItems.add(
+                new SinglePressAction(com.android.internal.R.drawable.ic_lock_screenshot, R.string.global_action_screenshot) {
+                    public void onPress() {
+                        takeScreenshot();
+                    }
 
-                public boolean showDuringKeyguard() {
-                    return true;
-                }
+                    public boolean showDuringKeyguard() {
+                        return true;
+                    }
 
-                public boolean showBeforeProvisioning() {
-                    return true;
-                }
-            });
+                    public boolean showBeforeProvisioning() {
+                        return true;
+                    }
+                });
+        }
 
         // next: airplane mode
-        mItems.add(mAirplaneModeOn);
+        if(mEnableAirplaneToggle) {
+            mItems.add(mAirplaneModeOn);
+        }
 
         // last: silent mode
-        if (SHOW_SILENT_TOGGLE) {
-            mItems.add(mSilentModeAction);
+        if(mEnableSoundToggle) {
+            if (SHOW_SILENT_TOGGLE) {
+                mItems.add(mSilentModeAction);
+            }
         }
 
 
-- 
1.7.9.5

